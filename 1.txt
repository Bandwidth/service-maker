
> service-maker@2.0.0 test c:\Users\rpoduval\Documents\nodejs_code\service-maker
> grunt

[4mRunning "jshint:src" (jshint) task[24m
[32m>> [39m7 files lint free.

[4mRunning "jshint:test" (jshint) task[24m
[32m>> [39m6 files lint free.

[4mRunning "jscs:src" (jscs) task[24m
[32m>> [39m13 files without code style errors.

[4mRunning "mochaIstanbul:coverage" (mochaIstanbul) task[24m
{ [Error: Cannot find module '../build/Release/bson'] code: 'MODULE_NOT_FOUND' }
{ [Error: Cannot find module '../build/Release/bson'] code: 'MODULE_NOT_FOUND' }


  The Instance model
    initialized with all valid parameters, state - running
      âˆš returns an Instance object
    initialized with all valid parameters, state - pending
      âˆš returns an Instance object
    initialized with invalid uri
      âˆš fails
    initialized with invalid state
      âˆš fails
    initialized with id missing
      âˆš fails
    initialized with using an array instead of string
      âˆš fails
    initialized with some parameters null
      âˆš fails
    initialized with type missing
      âˆš returns an Instance object
    initialized with some missing parameters
      âˆš fails
    initialized with all missing parameters
      âˆš fails
    initialized with adding properties that don't exist
      âˆš fails

  The Rest plugin
    âˆš is a Hapi plugin
    when registered
      âˆš provides the '/' route
    creating a new instance
      with valid parameters passed
        âˆš creates the instance and returns the canonical uri
      with no parameters passed
        âˆš creates the instance and returns the canonical uri
      with invalid parameter(s) passed
        âˆš returns an error with statusCode 400
    fails in creating a new instance
      when the credentials aren't properly configured
        âˆš returns an error with statusCode 500
      with an ami that doesn't exist
        âˆš returns an error with statusCode 400
      with a type that doesn't exist
        âˆš returns an error with statusCode 400
    when there is a problem with the database connection
      âˆš returns an internal server error with status code 500
    getting an instance
      with an invalid instance id
        âˆš shows the instance does not exist
      with a valid instance
MY DFDFDF"{\"id\":\"da14fbf2-5404-4f92-b55f-a961578204ed\",\"ami\":\"ami-d05e75b8\",\"type\":\"t2.micro\",\"state\":\"pending\",\"uri\":\"\"}"
        âˆš gets the instance of the requsted id
    querying for instances
      with a valid type
        âˆš returns an array of instances with the given type
      with an invalid instance by sending non-exisitng Instance Id and type
        âˆš returns an empty array of instances
      with a valid ID
        âˆš returns an instance with requested id
      with a valid AMI
        âˆš returns an array of instances with requested ami
      with state=pending
        âˆš returns an array of instances which are in a pending state
      with invalid URI
        âˆš returns an empty array of intsances
      with multiple values for a parameter
        âˆš fails and returns a Bad Request
    encountering an internal error
      failing to find an instance for specified instanceId
        âˆš fails
      failing to find all instances
        âˆš fails
    updating a created instance
      setting the state of a created instance to terminated
        when the instance is valid
          âˆš terminateInstances is called with the correct parameters
          âˆš the status is set to terminated
        when the instance ID doesn't exist
          âˆš a 404 error is thrown
        when the payload is malformed
          âˆš a 400 error is thrown
        when two requests are made simultaneously
          âˆš one succeeds while the other fails
        when there is an AWS error
          âˆš terminateInstances is called with the instance ID
          âˆš returns the instance with state set to terminating
          âˆš returns the instance with state set to failed
        when the connection to the database fails
          âˆš throws a 500 error
        when the database completely fails after terminateInstances has run
          âˆš terminateInstances is called with the instance ID
          âˆš leaves the state unchanged(terminating)
        when the database fails after terminateInstances has run, but then recovers
          âˆš terminateInstances is called with the instance ID
          âˆš updateInstance is called with the correct parameters the second time
          âˆš updateInstance is called with the correct parameters the third time
          âˆš getInstance is called with the correct parameters the second time
          âˆš changes the state to failed
        when the getInstance fails after the second updateInstance fails
          âˆš terminateInstances is called with the instance ID
          âˆš updateInstance is called with the correct parameters the second time
          âˆš getInstance is called with the correct parameters the second time
          âˆš leaves the state unchanged(stopping)
        when the database and terminateInstances fail
          âˆš terminateInstances is called with the instance ID
          âˆš getInstance is called with the correct parameters the second time
          âˆš leaves the state unchanged(terminating)
      setting the state of a created instance to stopped
        when the instance is valid
          âˆš stopInstances is called with the correct parameters
          âˆš the status is set to stopped
        when the instance ID doesn't exist
          âˆš a 404 error is thrown
        when the payload is malformed
          âˆš a 400 error is thrown
        when two requests are made simultaneously
          âˆš one succeeds while the other fails
        when there is an AWS error
          âˆš returns the instance with state set to stopping
          âˆš then updates the instance state set to failed
        when the connection to the database fails
          âˆš throws a 500 error
        when the database completely fails after stopInstances has run
          âˆš updateInstance is called with the correct parameters the second time
          âˆš stopInstances is called with the instance ID
          âˆš leaves the state unchanged(stopping)
        when the database fails after stopInstances has run, but then recovers
          âˆš stopInstances is called with the instance ID
          âˆš updateInstance is called with the correct parameters the second time
          âˆš updateInstance is called with the correct parameters the third time
          âˆš getInstance is called with the correct parameters the second time
          âˆš leaves the state unchanged(stopping)
        when the getInstance fails after the second updateInstance fails
          âˆš updateInstance is called with the correct parameters the second time
          âˆš stopInstances is called with the instance ID
          âˆš getInstance is called with the correct parameters the second time
          âˆš leaves the state unchanged(stopping)
        when the database and stopInstances completely fail
          âˆš stopInstances is called with the instance ID
          âˆš getInstance is called with the correct parameters the second time
          âˆš leaves the state unchanged(stopping)
      setting the status of an instance to a state not handled by update
        âˆš throws an error
        âˆš leaves the instance unmodified
    creating awsAdapter object when the options passed are invalid
      âˆš fails
    Deleting an instance
      with an invalid instance id
        âˆš shows the instance does not exist
      with a valid instance id
        âˆš returns the instance state with state set to terminating
        âˆš status is updated to terminated
      when there is a AWS error 
        âˆš returns the instance state with state set to terminating
        âˆš then updates the instance state set to failed
      when the connection to the database fails
        âˆš returns a 500 error
      when the database fails after terminateInstances has run
        âˆš terminateInstances is called with instance id
        âˆš leaves the state unchanged (terminating)
      when the database fails after terminateInstances has run, but then recovers
        âˆš terminateInstances is called with the instance ID
        âˆš updateInstance is called with the correct parameters the second time
        âˆš updateInstance is called with the correct parameters the third time
        âˆš getInstance is called with the correct parameters the second time
        âˆš changes the state to failed
      when the getInstance fails after the second updateInstance fails
        âˆš terminateInstances is called with the instance ID
        âˆš updateInstance is called with the correct parameters the second time
        âˆš getInstance is called with the correct parameters
        âˆš leaves the state unchanged(stopping)

  The server
    âˆš registers the Rest plugin

  The AwsAdapter class 
    trying to create a new instance
      with valid parameters
        âˆš creates the security group
        âˆš adds rules for SSH to the security group
        âˆš and returns a new instance with the ami and type provided
      with a security group name that already exists
        âˆš finds the group already created
        âˆš checks that it isn't modified
        âˆš and returns a new instance with the ami and type provided
      when an error occurs with creating the security group
        âˆš expects an error
        âˆš doesn't create a new instance
        âˆš doesn't try adding rules to the security group
      with invalid ami
        âˆš throws an InvalidAMIID.Malformed error
      with invalid type
        âˆš throws an InvalidParameterValue
    gets properties of given instance
      âˆš gets properties of the given instance
    gets properties of invalid instance
      âˆš fails
    gets the IP Address of the instance
      âˆš gets a valid IP address
    begins Polling
      and gets IP address of instance
        âˆš updates the state and uri of the instance
      and faces error while updating the instance
        âˆš throws an error
      and faces an error while polling
        âˆš updates the state and uri of the instance
      faces an error while polling and updating instance fails as well
        âˆš fails to update the state and uri of the instance
      gets IP address and tries to update an instance which has already been modified
        âˆš does not update the current instance status
      faces an error while polling and tries to update an instance which has already been modified
        âˆš does not update the current instance status
      faces an error while polling and getInstance does not show state has been updated
        âˆš fails to update as it has wrong revision number
    Trying to create awsAdapter Instance
      with missing parameters
        âˆš fails to create an object
      with invalid parameters
        âˆš fails to create an object
    terminating an instance
      when the instance is running
        âˆš gets the details of the instance, sets the state on the AWS console to terminated
        âˆš starts terminating the instance
        âˆš waits for the instance to be terminated
        âˆš checks the instance is terminated
      when the instance has already been terminated (doesn't exist)
        âˆš throws an error
      when waitFor times out
        âˆš gets the instance details
        âˆš starts terminating the instance
        âˆš times out
    stopping an instance
      when the instance is running
        âˆš gets the details of the instance, sets the state on the AWS console to stopped
        âˆš initiates stopping the instance
        âˆš waits for the instance to be stopped
        âˆš checks the instance has been stopped
      when the instance doesn't exist
        âˆš throws an error
      when waitFor times out
        âˆš gets the instance details
        âˆš starts terminating the instance
        âˆš times out

  The InstanceAdapter class 
    âˆš is immutable
    creating a new instance
      âˆš returns a new instance with default values
    creating a new instance, passing ami and type
      âˆš returns a new instance with default values
    Getting an instance
      with a valid instanceId
        âˆš gets a valid instance
      with a non-existent instanceId
        âˆš fails
    Querying for instances
      with valid parameters
        âˆš receives an array of instances
      with no parameters
        âˆš receives an array of all instances
      with a query that doesn't match any instance
        âˆš returns an empty array
    The mapper faces an internal error
      when the mapper fails to create a new model
        âˆš throws an error
      when the mapper fails to find an instance
        âˆš throws an error
      when the mapper fails to find an instance for the queried parameters
        âˆš throws an error
    updating an already created instance
      âˆš updates the instance and sets state to failed

  The SSH Adapter Class
    Checks if it is possible to ssh
      once the status checks have passed
MY ID:i-fbf47257
        âˆš returns that it is possible to ssh
      as soon as instance is created
MY ID:i-fbf47257
        âˆš is not possible to ssh currently
      when system checks have failed
MY ID:i-fbf47257
        âˆš it returns an error
      when there is insufficient-data
MY ID:i-fbf47257
        âˆš it returns an error
    Starts ssh Polling
      when system checks have passed
        âˆš is possible to ssh now
      when it is still performing system checks
        âˆš is possible to ssh eventually
      when system checks have failed
        âˆš it throws an error
      when system checks detects insufficient-data
        âˆš it throws an error
      when ssh polling encounters a timeout
        âˆš it throws an error
    Aws faces an internal error
MY ID:i-fbf47257
      âˆš encounters an error


  159 passing (1s)


=============================== Coverage summary ===============================
Statements   : 95.74% ( 315/329 )
Branches     : 94.2% ( 65/69 )
Functions    : 93.02% ( 80/86 )
Lines        : 95.74% ( 315/329 )
================================================================================
[33mWarning:  Use --force to continue.[39m

[31mAborted due to warnings.[39m
